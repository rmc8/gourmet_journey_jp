# グルメジャーニー - 要件定義書

## プロジェクト概要

### アプリケーション名
- **正式名称**: グルメジャーニー
- **英語名**: gourmet_journey_jp
- **サブタイトル**: 全国47都道府県のご当地グルメお取り寄せ管理アプリ

### 目的
全国47都道府県のご当地グルメのお取り寄せを管理し、効率的に制覇を目指すためのデスクトップ・モバイルアプリケーション

### 技術スタック
- **フロントエンド**: SvelteKit + TypeScript
- **バックエンド**: Tauri V2
- **データベース**: Firebase Firestore
- **対象プラットフォーム**: Windows/Mac/Android（iOS は優先度低）

## 機能要件

### 1. 都道府県ヒートマップ表示
- **目的**: 食事完了回数に応じた視覚的な進捗表示
- **表示基準**: 食事完了回数（購入のみは対象外）
- **色彩設計**: 暖色系グラデーション
  - 0回: グレー
  - 1-3回: オレンジ系段階表示
  - 4-10回: 赤系段階表示
  - 10回超: 相対評価での動的色分け
- **インタラクション**: ホバー詳細表示、クリックで記録一覧

### 2. ルーレット機能
- **目的**: 購入回数最小の都道府県からランダム選択
- **判定基準**: 購入済み回数（偏り防止のため）
- **アニメーション**: 3-5秒の視覚的演出
- **結果表示**: 都道府県名 + 外部検索ボタン群

### 3. お取り寄せ記録管理（CRUD）
#### データ構造
```typescript
interface GourmetRecord {
  id: string;
  product_name: string;        // 商品名（必須）
  product_url?: string;        // 商品URL（任意）
  order_date: Date;           // 注文日（必須）
  prefecture: string;         // 都道府県（必須）
  price?: number;             // 価格（任意）
  shop_url?: string;          // 購入先URL（任意）
  shop_name?: string;         // ショップ名（任意）
  
  // ステータス管理
  status: "purchased" | "completed";  // 購入済み | 食事完了
  
  // 食事完了時のみ
  rating: number;             // 0=未評価, 1-5=評価済み（整数）
  photo_url?: string;         // 写真URL（任意）
  meal_date?: Date;           // 食事日（任意）
  memo?: string;              // メモ（任意）
  
  // メタデータ
  created_at: Date;
  updated_at: Date;
  is_deleted: boolean;        // 論理削除フラグ
  deleted_at?: Date;
}
```

#### 機能詳細
- **作成**: 購入時点で「購入済み」として記録
- **更新**: 食事完了時にステータス変更・評価追加
- **削除**: 論理削除（30日間ゴミ箱保持）
- **復旧**: ゴミ箱からの復元機能

### 4. 外部検索連携
#### 対象サービス
1. **Perplexity**（最優先）
   - URL: `https://www.perplexity.ai/search?q={query}`
   - クエリ: 5-10パターンの多様な検索クエリ
   - ユーザーインストラクション追加機能
2. **Yahoo ショッピング**
   - URL: `https://shopping.yahoo.co.jp/search?p={prefecture}+特産品`
3. **楽天市場**
   - URL: `https://search.rakuten.co.jp/search/mall/{prefecture}+グルメ`
4. **Amazon**
   - URL: 要実装

#### Perplexity クエリパターン例
- `{都道府県}の美味しい特産品・グルメお取り寄せおすすめ`
- `{都道府県}の郷土料理・ご当地グルメをお取り寄せで楽しむ`
- `{都道府県}産の名物・特産品の人気お取り寄せ商品`
- 他 5-10パターン

### 5. 検索・フィルタリング機能
#### 検索条件
- **都道府県別**: プルダウン選択
- **評価フィルター**: 範囲指定（1-5段階）
- **日付範囲**: カレンダー選択
- **商品名検索**: 部分一致（技術制約により工夫必要）
- **ステータス**: 購入済み/食事完了/全て

#### 表示仕様
- **デフォルトソート**: 購入日降順
- **表示形式**: テーブル優先、リスト表示も対応
- **AND条件**: 複数条件での絞り込み
- **無限スクロール**: 対応（ただし大量データは想定外）

### 6. 統計・分析機能
#### 制覇状況
- **購入制覇率**: 47都道府県中の購入済み県数
- **食事制覇率**: 47都道府県中の食事完了県数
- **周回数**: 最低回数県基準での進捗

#### グラフ表示
- **月別推移**: 積み上げ棒グラフ（購入・完了を色分け）
- **期間**: 過去1年間
- **評価分析**: 全体平均、都道府県別ランキング
- **支出分析**: 月別支出、総支出額

### 7. エクスポート・インポート機能（優先度低）
- **形式**: JSON
- **対象**: 全データ（写真URL含む）
- **範囲**: 全期間のみ

## 技術仕様

### Firebase設定
#### Firestore構造
```javascript
// メインコレクション
gourmet_records: {
  // GourmetRecord構造（上記参照）
}

// 統計は毎回リアルタイム計算（個人利用のため）
```

#### Security Rules
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;  // 認証なし・制限なし
    }
  }
}
```

#### 環境変数管理
```typescript
// .env ファイルで Firebase設定を管理
VITE_FIREBASE_API_KEY=your_api_key_here
VITE_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your_project_id
// ...その他Firebase設定
```

### Tauri V2 モバイル対応
#### 対象プラットフォーム
- **Android**: 一般的なバージョンから対応
- **iOS**: 優先度低（開発者プログラム要）
- **権限**: ネットワーク通信のみ

#### モバイル最適化
- **画面向き**: 縦画面のみ
- **UI調整**: タッチ操作向けサイズ・配置
- **ジェスチャー**: スワイプ操作対応
- **機能統一**: 動作は PC と同一（表示のみ差異許容）

### パフォーマンス・エラーハンドリング
#### データ処理
- **統計計算**: リアルタイム集計（Firestore通信削減優先）
- **オフライン対応**: 望ましい機能として実装
- **部分一致検索**: Firestore制約への対応策検討

#### エラー処理
- **ユーザー表示**: 分かりやすい簡潔なメッセージ
- **クラッシュレポート**: 不要
- **使用統計**: 不要

## UI/UX要件

### デスクトップ版レイアウト
```
┌─────────────────────────────────────┐
│ ヘッダー（タイトル、統計サマリー）     │
├─────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────────┐ │
│ │  日本地図      │ │  ルーレット      │ │
│ │  ヒートマップ  │ │  ボタン         │ │
│ │               │ ├─────────────────┤ │
│ │               │ │  記録追加       │ │
│ │               │ │  ボタン         │ │
│ └─────────────┘ ├─────────────────┤ │
│                   │  検索・フィルター │ │
│                   │  ボタン         │ │
└─────────────────────────────────────┘
```

### モバイル版レイアウト
- **ボトムナビゲーション**: 主画面/記録/統計/設定
- **縦積みレイアウト**: 地図→機能ボタン群
- **タッチ最適化**: 44px以上のボタンサイズ

### フォーム設計
#### 記録追加・編集
1. **必須項目**: 商品名、都道府県、注文日
2. **ステータス選択**: 購入済み/食事完了
3. **段階表示**: ステータスに応じた項目表示切り替え
4. **任意項目**: 価格、URL関連、ショップ情報

#### バリデーション
- **必須項目**: 視覚的強調表示
- **評価**: 0-5の整数値
- **日付**: 日付ピッカーでの入力

## 開発優先度

### MVP（v1.0.0）- 2025年7月末
1. **都道府県データ管理システム**
2. **ヒートマップ表示機能**
3. **基本記録CRUD機能**
4. **Firebase連携**

### 拡張機能（v1.1.0）- 2025年9月末
1. **ルーレット機能**
2. **外部検索連携**
3. **検索・フィルタリング**
4. **統計・分析機能**
5. **UI/UX改善**

### 将来機能（v1.2.0以降）
1. **エクスポート・インポート**
2. **ゴミ箱機能**
3. **モバイル最適化**
4. **パフォーマンス改善**

## 制約・前提条件

### 利用想定
- **利用者**: 個人利用、限定された小グループ
- **データ量**: 1万件未満を想定
- **認証**: なし（利用者責任でのデータ管理）

### 写真管理
- **保存方式**: ユーザー提供URL（外部ストレージ活用）
- **アプリ内保存**: なし（CloudFlare R2等は利用者が準備）

### 配布方式
- **GitHub**: ソースコード公開
- **アプリストア**: 非対応
- **ビルド配布**: グループ向けカスタムビルド

## 補足事項

### Firebase Security Rules について
Firebase Security Rules は Firestore データベースへのアクセス制御ルールです。通常はユーザー認証や権限管理を行いますが、本アプリでは：
- 認証機能なし
- 全ユーザーがデータを完全共有
- 利用者責任でのデータ保護
という方針のため、最もシンプルな設定となります。

### Firestore検索制約について
Firestore は SQL LIKE に相当する部分一致検索に制約があります。商品名での部分一致検索には以下の対応策を検討：
1. クライアント側での全データ取得後フィルタリング
2. 商品名の単語分割・タグ化
3. 外部検索サービス（Algolia等）の活用

### 開発着手準備
この要件定義書に基づき、以下の準備が完了次第開発着手可能：
1. Firebase プロジェクト作成・設定
2. 開発環境構築（Node.js、Rust、Tauri CLI）
3. GitHub Issue の詳細化・優先度設定
4. 初期プロトタイプの開発計画策定